{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Control de Correos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Fondo con imagen */
        body {
            background: url("{% static 'img/exponentes.png' %}") no-repeat center center fixed;
            background-size: cover;
            color: #f0f0f0;
            min-height: 100vh;
            position: relative;
        }

        /* Overlay oscuro */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 0;
        }

        /* Contenido sobre el overlay */
        .content {
            position: relative;
            z-index: 1;
        }

        /* Cards */
        .card {
            background-color: rgba(30, 0, 60, 0.6); /* más transparente para ver el fondo */
            border-radius: 15px;
            color: #ffffff;
        }

        .card-header {
            background-color: #6a0dad;
            color: #fff;
            font-weight: bold;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        /* Botones */
        .btn-primary, .btn-success, .btn-danger {
            color: #fff;
        }

        .btn-primary { background-color: #6a0dad; border-color: #4b0082; }
        .btn-primary:hover { background-color: #8000ff; border-color: #4b0082; }
        .btn-success { background-color: #4b0082; border-color: #6a0dad; }
        .btn-success:hover { background-color: #6a0dad; border-color: #8000ff; }
        .btn-danger { background-color: #c100ff; border-color: #6a0dad; }
        .btn-danger:hover { background-color: #8000ff; border-color: #4b0082; }
        .btn-outline-secondary { color: #fff; border-color: #c100ff; }
        .btn-outline-secondary:hover { background-color: #4b0082; border-color: #c100ff; }

        /* Tabla transparente */
        table.table {
            background-color: rgba(0,0,0,0.4); /* transparente para ver fondo */
            color: #fff;
        }
        table.table th {
            background-color: rgba(75, 0, 130, 0.7);
            color: #fff;
        }
        table.table td {
            border-color: rgba(106, 13, 173, 0.5);
        }

        /* Badges */
        .badge {
            font-weight: bold;
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #6a0dad;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #2a0033;
        }
    </style>
</head>
<body>
<div class="container py-5 content">

    <!-- Encabezado -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold">
            <i class="bi bi-envelope-check-fill"></i> Panel de Control de Correos
        </h1>
        <div>
            <a href="{% url 'exportar_excel_control' %}" class="btn btn-success me-2">
                <i class="bi bi-file-earmark-excel"></i> Exportar Excel
            </a>
            <a href="{% url 'exportar_pdf' %}" class="btn btn-danger me-2">
                <i class="bi bi-filetype-pdf"></i> Exportar PDF
            </a>
            <a href="{% url 'lista' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left-circle"></i> Volver a la lista
            </a>
        </div>
    </div>
<br><br><br><br>
    <!-- Tabla dentro de card -->
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="text-center">
                        <tr>
                            <th><i class="bi bi-person-fill"></i> Nombre</th>
                            <th><i class="bi bi-envelope-at-fill"></i> Correo</th>
                            <th><i class="bi bi-ticket-perforated-fill"></i> Entrada</th>
                            <th><i class="bi bi-calendar-event"></i> Fecha Envío</th>
                            <th><i class="bi bi-check2-circle"></i> Estado</th>
                            <th><i class="bi bi-gear-fill"></i> Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in registros %}
                        <tr>
                            <td>{{ r.participante.nombres }} {{ r.participante.apellidos }}</td>
                            <td>{{ r.participante.correo }}</td>
                            <td class="text-center">
                                <span class="badge bg-info text-dark">{{ r.participante.tipo_entrada }}</span>
                            </td>
                            <td>{{ r.fecha_envio|date:"d/m/Y" }}</td>
                            <td class="text-center">
                                {% if r.enviado %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Enviado</span>
                                {% else %}
                                    <span class="badge bg-danger"><i class="bi bi-x-circle-fill"></i> No enviado</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <a href="{% url 'reenviar_correo' r.id %}" class="btn btn-sm btn-outline-warning">
                                    <i class="bi bi-arrow-repeat"></i> Reenviar
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center text-muted py-3">
                                <i class="bi bi-inbox"></i> No hay registros de correos.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<script>
function actualizarTabla() {
    fetch("{% url 'registros_json' %}")
        .then(res => res.json())
        .then(data => {
            let tbody = document.querySelector("table.table tbody");
            tbody.innerHTML = "";
            data.registros.forEach(r => {
                tbody.innerHTML += `
                    <tr>
                        <td>${r.nombre}</td>
                        <td>${r.correo}</td>
                        <td class="text-center"><span class="badge bg-info text-dark">${r.entrada}</span></td>
                        <td>${r.fecha}</td>
                        <td class="text-center">
                            ${r.estado 
                                ? '<span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Enviado</span>'
                                : '<span class="badge bg-danger"><i class="bi bi-x-circle-fill"></i> No enviado</span>'}
                        </td>
                        <td class="text-center">
                            <a href="{% url 'reenviar_correo' 0 %}".replace("0", r.id) class="btn btn-sm btn-outline-warning">
                                <i class="bi bi-arrow-repeat"></i> Reenviar
                            </a>
                        </td>
                    </tr>`;
            });
        });
}

// refrescar cada 5 segundos
setInterval(actualizarTabla, 5000);
</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
